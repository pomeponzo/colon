<!DOCTYPE html>
<html lang="fr">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
   <title>Quel est votre profil digestif ? - Quiz personnalis√©</title>
   <style>
       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
           -webkit-tap-highlight-color: transparent;
       }

        html, body {
            height: 100vh;
            height: 100dvh;
            width: 100%;
            overflow: hidden;
        }

       body {
           font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', Roboto, 'Helvetica Neue', Arial, sans-serif;
           background: #ffffff;
           margin: 0;
           padding: 0;
       }

       .app-container {
           background: #ffffff;
           width: 100%;
           height: 100vh;
           height: 100dvh;
           display: flex;
           flex-direction: column;
           overflow: hidden;
       }

       @media (min-width: 600px) {
           .app-container {
               max-width: 500px;
               margin: 0 auto;
           }
       }

       .app-header {
           display: flex;
           align-items: center;
           justify-content: space-between;
           padding: 12px 16px;
           background: white;
           border-bottom: 1px solid rgba(0, 0, 0, 0.05);
           flex-shrink: 0;
           z-index: 10;
           height: 48px;
           position: relative;
       }

       .back-button {
           background: none;
           border: none;
           color: #64748b;
           cursor: pointer;
           padding: 6px;
           border-radius: 8px;
           transition: all 0.2s ease;
           display: flex;
           align-items: center;
           justify-content: center;
           width: 32px;
           height: 32px;
       }

       .back-button:hover {
           background: rgba(139, 92, 246, 0.1);
           color: #7c3aed;
       }

       .back-button svg {
           width: 18px;
           height: 18px;
       }

       .app-logo {
           font-size: 1rem;
           font-weight: 600;
           background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
           background-clip: text;
           position: absolute;
           left: 50%;
           transform: translateX(-50%);
       }

       .header-right {
           display: flex;
           align-items: center;
           gap: 10px;
       }

       .step-counter {
           font-size: 0.8rem;
           color: #64748b;
           font-weight: 500;
           min-width: 44px;
           text-align: right;
       }

       .legal-links {
           display: flex;
           align-items: center;
           justify-content: center;
           gap: 8px;
           flex-wrap: wrap;
           font-size: 0.8rem;
           color: #64748b;
           text-align: center;
       }

       .legal-links a {
           color: inherit;
           text-decoration: none;
           font-weight: 500;
       }

       .legal-links a:hover {
           color: #7c3aed;
           text-decoration: underline;
       }

       .legal-separator {
           color: rgba(100, 116, 139, 0.6);
       }

       .legal-footer {
           padding: 12px 16px;
           background: white;
           border-top: 1px solid rgba(0, 0, 0, 0.05);
           flex-shrink: 0;
       }

       @media (max-width: 599px) {
           .legal-links {
               justify-content: center;
           }
       }

       .progress-bar {
           height: 2px;
           background: rgba(0, 0, 0, 0.05);
           position: relative;
           overflow: hidden;
           flex-shrink: 0;
       }

       .progress-fill {
           height: 100%;
           background: linear-gradient(90deg, #8b5cf6 0%, #7c3aed 100%);
           transition: width 0.5s cubic-bezier(0.4, 0.0, 0.2, 1);
       }

       /* Masquer le bouton "Continuer" du quiz sur l'√©tape email :
          on ne veut garder que le bouton Syst√®me.io */
       #emailQuestion .continue-button {
           display: none !important;
       }

       .app-content {
           flex: 1;
           display: flex;
           flex-direction: column;
           overflow: hidden;
           padding: 16px;
           min-height: 0;
       }

       .question-section {
           display: none;
           flex: 1;
           flex-direction: column;
           animation: slideIn 0.3s ease;
           overflow: hidden;
       }

       .question-section.active {
           display: flex;
       }

       @keyframes slideIn {
           from {
               opacity: 0;
               transform: translateY(10px);
           }
           to {
               opacity: 1;
               transform: translateY(0);
           }
       }

       .question-content {
           flex: 1;
           display: flex;
           flex-direction: column;
           overflow-y: auto;
           overflow-x: hidden;
           -webkit-overflow-scrolling: touch;
           padding: 4px;
           margin: -4px;
       }

       .question-header {
           margin-bottom: 20px;
           flex-shrink: 0;
       }

       .question-title {
           font-size: 1.4rem;
           font-weight: 700;
           color: #1e293b;
           margin-bottom: 8px;
           line-height: 1.3;
       }

       .question-subtitle {
           font-size: 0.95rem;
           color: #64748b;
           line-height: 1.5;
       }

       .options-container {
           display: flex;
           flex-direction: column;
           gap: 8px;
           flex: 1;
           min-height: 0;
       }

       .options-grid {
           display: grid;
           grid-template-columns: repeat(2, minmax(0, 1fr));
           gap: 14px;
       }

       .options-grid-mobile-2 {
           grid-template-columns: repeat(2, minmax(0, 1fr));
       }

       .option-card {
           background: white;
           border: 2px solid #e5e7eb;
           border-radius: 10px;
           padding: 12px;
           cursor: pointer;
           transition: all 0.2s ease;
           display: flex;
           align-items: center;
           gap: 10px;
           flex-shrink: 0;
       }

       .option-card.image-option {
           flex-direction: column;
           align-items: center;
           gap: 16px;
           padding: 32px 18px 20px;
           overflow: visible;
           position: relative;
       }

       .option-card.image-option .option-image-wrapper {
           width: 100%;
           display: flex;
           justify-content: center;
           position: relative;
           margin-top: -36px;
       }

       .option-card.image-option .option-image {
           width: 100%;
           display: block;
           aspect-ratio: 3 / 4;
           object-fit: cover;
           object-position: top center;
           border-radius: 16px;
           box-shadow: 0 8px 18px rgba(15, 23, 42, 0.12);
           transform: translateY(-18px);
       }

       .option-card.image-option .option-text {
           width: 100%;
           display: flex;
           align-items: center;
           justify-content: center;
           padding: 0 44px 0 4px;
           position: relative;
       }

       .option-card.image-option .option-label {
           font-size: 1.05rem;
           text-align: center;
       }

       .option-card.image-option .option-arrow {
           position: absolute;
           right: 0;
           top: 50%;
           transform: translateY(-50%);
           width: 36px;
           height: 36px;
           border-radius: 50%;
           background: rgba(15, 23, 42, 0.05);
           display: flex;
           align-items: center;
           justify-content: center;
           color: #1e293b;
           font-weight: 600;
           font-size: 1rem;
           box-shadow: 0 2px 6px rgba(15, 23, 42, 0.12);
           transition: all 0.2s ease;
       }

       .option-card.image-option.selected .option-arrow {
           background: rgba(139, 92, 246, 0.15);
           color: #7c3aed;
           transform: translateY(-50%) scale(1.05);
       }

       @media (max-width: 599px) {
           .option-card.image-option {
               padding: 28px 16px 18px;
               gap: 14px;
           }

           .option-card.image-option .option-image-wrapper {
               margin-top: -32px;
           }

           .option-card.image-option .option-arrow {
               width: 32px;
               height: 32px;
               right: 2px;
           }
       }

       .option-card:hover {
           border-color: #8b5cf6;
           background: rgba(139, 92, 246, 0.02);
       }

       .option-card.selected {
           border-color: #8b5cf6;
           background: rgba(139, 92, 246, 0.05);
       }

       .option-emoji {
           font-size: 1.6rem;
           flex-shrink: 0;
       }

       .option-text {
           flex: 1;
       }

       .option-label {
           font-size: 0.95rem;
           font-weight: 600;
           color: #1e293b;
           margin-bottom: 1px;
       }

       .option-description {
           font-size: 0.8rem;
           color: #64748b;
           line-height: 1.35;
       }

       .option-card input[type="checkbox"] {
           width: 18px;
           height: 18px;
           cursor: pointer;
           flex-shrink: 0;
           accent-color: #8b5cf6;
       }

       .continue-button {
           width: 100%;
           background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
           color: white;
           border: none;
           border-radius: 12px;
           padding: 16px;
           font-size: 1rem;
           font-weight: 600;
           cursor: pointer;
           margin-top: 16px;
           transition: all 0.2s ease;
           flex-shrink: 0;
           box-shadow: 0 2px 8px rgba(139, 92, 246, 0.2);
       }

       .continue-button:hover {
           transform: translateY(-1px);
           box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
       }

       .continue-button:active {
           transform: translateY(0);
       }

       .continue-button:disabled {
           opacity: 0.5;
           cursor: not-allowed;
           transform: none;
       }

       .options-scroll-container {
           display: flex;
           flex-direction: column;
           gap: 12px;
           max-height: 320px;
           overflow-y: auto;
           padding-right: 4px;
       }

       .options-scroll-container::-webkit-scrollbar {
           width: 6px;
       }

       .options-scroll-container::-webkit-scrollbar-thumb {
           background: rgba(124, 58, 237, 0.3);
           border-radius: 999px;
       }

       @media (max-width: 599px) {
           .options-grid {
               grid-template-columns: 1fr;
           }

           .options-grid-mobile-2 {
               grid-template-columns: repeat(2, minmax(0, 1fr));
           }
       }

       .email-step {
           display: flex;
           flex-direction: column;
           gap: 12px;
       }

       .email-step-actions {
           display: flex;
           gap: 12px;
           margin-top: 16px;
       }

       #emailQuestion .continue-button {
           margin-top: 0;
           flex: 2;
       }

       .email-back-button {
           flex: 1;
           border: 2px solid #e5e7eb;
           border-radius: 10px;
           background: #ffffff;
           color: #312e81;
           font-size: 0.95rem;
           font-weight: 600;
           padding: 12px 16px;
           cursor: pointer;
           transition: all 0.2s ease;
           display: none;
           align-items: center;
           justify-content: center;
       }

       .email-back-button:hover {
           border-color: rgba(124, 58, 237, 0.4);
           color: #7c3aed;
       }

       .email-fallback {
           display: none;
           flex-direction: column;
           gap: 10px;
       }

       .email-fallback.active {
           display: flex;
       }

       .email-helper-text {
           font-size: 0.85rem;
           color: #64748b;
           line-height: 1.4;
       }

       .email-feedback {
           font-size: 0.85rem;
           min-height: 1em;
       }

       .email-feedback.error {
           color: #dc2626;
       }

       .email-feedback.success {
           color: #16a34a;
       }

       .input-field {
           width: 100%;
           padding: 14px;
           border: 2px solid #e5e7eb;
           border-radius: 10px;
           font-size: 0.95rem;
           transition: all 0.2s ease;
           font-family: inherit;
       }

       .input-field:focus {
           outline: none;
           border-color: #8b5cf6;
           background: rgba(139, 92, 246, 0.02);
       }

       .sr-only {
           position: absolute;
           width: 1px;
           height: 1px;
           padding: 0;
           margin: -1px;
           overflow: hidden;
           clip: rect(0, 0, 0, 0);
           white-space: nowrap;
           border: 0;
       }

       .result-section {
           display: none;
           flex-direction: column;
           gap: 20px;
           animation: slideIn 0.3s ease;
       }

       .result-section.active {
           display: flex;
       }

       .result-card {
           background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(124, 58, 237, 0.05) 100%);
           border: 2px solid rgba(139, 92, 246, 0.2);
           border-radius: 16px;
           padding: 24px;
       }

       .result-title {
           font-size: 1.3rem;
           font-weight: 700;
           color: #1e293b;
           margin-bottom: 12px;
       }

       .result-text {
           font-size: 0.95rem;
           color: #475569;
           line-height: 1.6;
           margin-bottom: 12px;
       }

       .result-highlight {
           background: white;
           border-left: 4px solid #8b5cf6;
           padding: 16px;
           border-radius: 8px;
           margin: 16px 0;
       }

       .result-highlight-title {
           font-size: 1rem;
           font-weight: 600;
           color: #7c3aed;
           margin-bottom: 8px;
       }

       .cta-button {
           width: 100%;
           background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
           color: white;
           border: none;
           border-radius: 12px;
           padding: 18px;
           font-size: 1.1rem;
           font-weight: 600;
           cursor: pointer;
           transition: all 0.2s ease;
           box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
           margin-top: 8px;
       }

       .cta-button:hover {
           transform: translateY(-2px);
           box-shadow: 0 6px 16px rgba(139, 92, 246, 0.4);
       }

       .loader {
           display: none;
           flex-direction: column;
           align-items: center;
           justify-content: center;
           height: 100%;
           gap: 20px;
       }

       .loader.active {
           display: flex;
       }

       .spinner {
           width: 50px;
           height: 50px;
           border: 3px solid rgba(139, 92, 246, 0.2);
           border-top-color: #8b5cf6;
           border-radius: 50%;
           animation: spin 0.8s linear infinite;
       }

       @keyframes spin {
           to { transform: rotate(360deg); }
       }

       .loader-text {
           font-size: 1rem;
           color: #64748b;
           text-align: center;
       }
        
/* ===== Q1 ‚Äî Grille 2√ó2 sans scroll, cartes qui s'adaptent, images nickel ===== */

/* 1) Le conteneur Q1 occupe toute la hauteur scrolable */
.q1 .question-content{ display:flex; flex-direction:column; min-height:0; }
.q1 .options-container{ flex:1; min-height:0; }

/* 2) Grille 2√ó2 qui prend 100% de la hauteur disponible */
.q1 .options-grid{
  display:grid;
  height:100%;
  grid-template-columns: repeat(2, 1fr);
  grid-template-rows: repeat(2, minmax(0,1fr));   /* 2 lignes √©gales qui tiennent */
  gap:10px;
}

/* 3) Chaque carte remplit sa cellule (plus de d√©bordement) */
.q1 .option-card.image-option{
  height:100%;
  border-radius:12px;
  padding:12px 10px 6px;
  display:flex;
  flex-direction:column;
  overflow:visible; /* pour laisser d√©passer un peu la t√™te */
}

/* 4) L‚Äôimage prend l‚Äôespace restant ; le label a une hauteur connue */
.q1 .option-image-wrapper{
  flex:1;                 /* <-- cl√© : la zone image occupe tout le restant */
  display:flex;
  align-items:stretch;
  margin-top:-12px;       /* fait remonter la t√™te */
}
.q1 .option-image{
  width:100%;
  height:100%;            /* on remplit la zone, pas de hauteur ‚Äúauto‚Äù */
  object-fit:cover;
  object-position:50% 0%; /* cadrage vers le haut */
  border-radius:12px;
  transform:translateY(-6px); /* l√©g√®re sortie de cadre */
  box-shadow:none;        /* pas d‚Äôombre parasite */
  aspect-ratio:auto;      /* on s‚Äôaffranchit d‚Äôun ratio fig√© */
}

/* 5) Zone texte compacte et centr√©e */
.q1 .option-text{
  display:flex; align-items:center; justify-content:center;
  padding:0 28px;
  min-height:42px;        /* r√©serve stable pour le libell√© + fl√®che */
  text-align:center;
}
.q1 .option-label{ font-size:.98rem; font-weight:800; }
.q1 .option-arrow{ width:28px; height:28px; right:0; top:50%; position:absolute; transform:translateY(-50%); border-radius:50%; background:rgba(15,23,42,.06); display:flex; align-items:center; justify-content:center; }

/* 6) Ent√™te un poil compact pour gagner quelques px */
.q1 .question-header{ margin-bottom:8px; }
.q1 .question-title{ font-size:1.16rem; margin-bottom:4px; }
.q1 .question-subtitle{ font-size:.9rem; }

/* √âcrans tr√®s courts : on compresse encore un chou√Øa */
@media (max-height:700px){
  .q1 .option-card.image-option{ padding:10px 8px 6px; }
  .q1 .option-image-wrapper{ margin-top:-10px; }
  .q1 .option-image{ transform:translateY(-5px); }
  .q1 .option-text{ min-height:38px; }
}

/* ====== FIX Q1 ‚Äî 2√ó2 sans scroll, cartes adapt√©es aux images ====== */
.q1 .options-grid{
  height:100%;
  display:grid !important;
  grid-template-columns:repeat(2,1fr) !important;
  grid-template-rows:repeat(2,minmax(0,1fr)) !important;
  gap:10px !important;
}

.q1 .option-card.image-option{
  height:100% !important;
  display:flex !important;
  flex-direction:column !important;
  padding:10px 10px 6px !important;
  border-radius:12px !important;
  overflow:visible !important;
}

.q1 .option-image-wrapper{
  flex:1 1 auto !important;           /* la zone image prend tout le restant */
  display:block !important;
  position:relative !important;
  margin:0 !important;                 /* on repart propre */
  overflow:visible !important;
}

.q1 .option-image{
  width:100% !important;
  height:100% !important;              /* l‚Äôimage remplit la zone */
  object-fit:cover !important;
  object-position:50% 0% !important;   /* cadrage vers le haut */
  border-radius:12px !important;
  box-shadow:none !important;          /* pas d‚Äôombre parasite */
  transform:translateY(-8px) !important; /* t√™te qui d√©passe l√©g√®rement */
  aspect-ratio:auto !important;
}

.q1 .option-text{
  position:relative !important;
  display:flex !important;
  align-items:center !important;
  justify-content:center !important;
  min-height:44px !important;          /* hauteur stable du label */
  padding:0 28px !important;
  text-align:center !important;
}

.q1 .option-label{ font-weight:800 !important; font-size:.98rem !important; }
.q1 .option-arrow{ width:28px !important; height:28px !important; right:0; top:50%; position:absolute; transform:translateY(-50%); border-radius:50%; background:rgba(15,23,42,.06); display:flex; align-items:center; justify-content:center; }

   </style>
   <style id="sioEmailButtonStyle">
     /* Style du bouton une fois d√©plac√© */
     #sioFieldsMount .sio-submit,
     #sioFieldsMount [type="submit"] {
       width: 100% !important;
       height: 48px !important;
       border-radius: 12px !important;
     }
   </style>
</head>
<body>
   <div class="app-container">
       <header class="app-header">
           <button class="back-button" id="backButton" aria-label="Retour">
               <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
               </svg>
           </button>
           <div class="app-logo">Profil Digestif</div>
           <div class="header-right">
               <span class="step-counter" id="stepCounter">1/12</span>
           </div>
       </header>

       <div class="progress-bar">
           <div class="progress-fill" id="progressFill" style="width: 8.33%"></div>
       </div>

       <main class="app-content">
            <!-- Question 1 -->
           <section class="question-section active q1" id="q1">
                <div class="question-content">
                    <div class="question-header">
                        <h2 class="question-title">üì∏ Quelle est votre tranche d'√¢ge&nbsp;?</h2>
                        <p class="question-subtitle">Nous utilisons uniquement votre √¢ge pour personnaliser vos r√©sultats.</p>
                    </div>
                    <div class="options-container options-grid options-grid-mobile-2">
                        <div class="option-card image-option" data-value="18-29">
                            <div class="option-image-wrapper">
                                <img src="https://d1yei2z3i6k35z.cloudfront.net/13114230/6904ca78095ce_1.png" alt="Femme √¢g√©e de 18 √† 29 ans" class="option-image">
                            </div>
                            <div class="option-text">
                                <div class="option-label">18-29 ans</div>
                                <div class="option-arrow">‚Üí</div>
                            </div>
                        </div>
                        <div class="option-card image-option" data-value="30-39">
                            <div class="option-image-wrapper">
                                <img src="https://d1yei2z3i6k35z.cloudfront.net/13114230/6904ca85bcd66_11.png" alt="Femme √¢g√©e de 30 √† 39 ans" class="option-image">
                            </div>
                            <div class="option-text">
                                <div class="option-label">30-39 ans</div>
                                <div class="option-arrow">‚Üí</div>
                            </div>
                        </div>
                        <div class="option-card image-option" data-value="40-49">
                            <div class="option-image-wrapper">
                                <img src="https://d1yei2z3i6k35z.cloudfront.net/13114230/6904cf88c27a4_14.png" alt="Femme √¢g√©e de 40 √† 49 ans" class="option-image">
                            </div>
                            <div class="option-text">
                                <div class="option-label">40-49 ans</div>
                                <div class="option-arrow">‚Üí</div>
                            </div>
                        </div>
                        <div class="option-card image-option" data-value="50+">
                            <div class="option-image-wrapper">
                                <img src="https://d1yei2z3i6k35z.cloudfront.net/13114230/6904ca9d70e30_13.png" alt="Femme de 50 ans et plus" class="option-image">
                            </div>
                            <div class="option-text">
                                <div class="option-label">50+ ans</div>
                                <div class="option-arrow">‚Üí</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Question 2 -->
            <section class="question-section" id="q2">
                <div class="question-content">
                    <div class="question-header">
                        <h2 class="question-title">üî• Quel sympt√¥me digestif vous g√¢che le plus la vie au quotidien&nbsp;?</h2>
                        <p class="question-subtitle">S√©lectionnez celui qui vous affecte le plus</p>
                    </div>
                    <div class="options-container">
                        <div class="option-card" data-value="ballonnements">
                            <span class="option-emoji">üî•</span>
                            <div class="option-text">
                                <div class="option-label">Ballonnements persistants</div>
                                <div class="option-description">Ventre gonfl√© comme une femme enceinte</div>
                            </div>
                        </div>
                        <div class="option-card" data-value="douleurs">
                            <span class="option-emoji">üí•</span>
                            <div class="option-text">
                                <div class="option-label">Douleurs et crampes abdominales</div>
                                <div class="option-description">Sensations insupportables</div>
                            </div>
                        </div>
                        <div class="option-card" data-value="transit">
                            <span class="option-emoji">üöΩ</span>
                            <div class="option-text">
                                <div class="option-label">Transit erratique</div>
                                <div class="option-description">Constipation, diarrh√©e ou alternance</div>
                            </div>
                        </div>
                        <div class="option-card" data-value="peur">
                            <span class="option-emoji">üò∞</span>
                            <div class="option-text">
                                <div class="option-label">Peur constante de manger</div>
                                <div class="option-description">Angoisse avant/apr√®s les repas</div>
                            </div>
                        </div>
                        <div class="option-card" data-value="tous">
                            <span class="option-emoji">üå™Ô∏è</span>
                            <div class="option-text">
                                <div class="option-label">Tous ces sympt√¥mes √† la fois</div>
                                <div class="option-description">C'est un calvaire quotidien</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Question 3 -->
            <section class="question-section" id="q3">
                <div class="question-content">
                    <div class="question-header">
                        <h2 class="question-title">üéöÔ∏è √Ä quelle fr√©quence ressentez-vous des ballonnements apr√®s les repas&nbsp;?</h2>
                        <p class="question-subtitle">S√©lectionnez la r√©ponse qui correspond le mieux √† votre situation</p>
                    </div>
                    <div class="options-container">
                        <div class="option-card" data-value="jamais">
                            <span class="option-emoji">1</span>
                            <div class="option-text">
                                <div class="option-label">1 Jamais</div>
                            </div>
                        </div>
                        <div class="option-card" data-value="rarement">
                            <span class="option-emoji">2</span>
                            <div class="option-text">
                                <div class="option-label">2 Rarement</div>
                            </div>
                        </div>
                        <div class="option-card" data-value="regulierement">
                            <span class="option-emoji">3</span>
                            <div class="option-text">
                                <div class="option-label">3 R√©guli√®rement</div>
                            </div>
                        </div>
                        <div class="option-card" data-value="tres-souvent">
                            <span class="option-emoji">4</span>
                            <div class="option-text">
                                <div class="option-label">4 Tr√®s souvent</div>
                            </div>
                        </div>
                        <div class="option-card" data-value="constamment">
                            <span class="option-emoji">5</span>
                            <div class="option-text">
                                <div class="option-label">5 Constamment</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Question 4 -->
            <section class="question-section" id="q4">
                <div class="question-content">
                    <div class="question-header">
                        <h2 class="question-title">‚è∞ Depuis combien de temps vivez-vous avec ces troubles digestifs&nbsp;?</h2>
                        <p class="question-subtitle">Cela nous aide √† comprendre votre parcours</p>
                    </div>
                   <div class="options-container">
                       <div class="option-card" data-value="moins-6-mois">
                           <span class="option-emoji">üïê</span>
                           <div class="option-text">
                               <div class="option-label">Moins de 6 mois</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="6-mois-2-ans">
                           <span class="option-emoji">üìÖ</span>
                           <div class="option-text">
                               <div class="option-label">Entre 6 mois et 2 ans</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="2-5-ans">
                           <span class="option-emoji">‚è∞</span>
                           <div class="option-text">
                               <div class="option-label">Entre 2 et 5 ans</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="plus-5-ans">
                           <span class="option-emoji">üòî</span>
                           <div class="option-text">
                               <div class="option-label">Plus de 5 ans</div>
                           </div>
                       </div>
                   </div>
                </div>
            </section>

           <!-- Question 5 -->
           <section class="question-section" id="q5">
               <div class="question-content">
                   <div class="question-header">
                       <h2 class="question-title">üíî Comment vos probl√®mes digestifs affectent-ils votre quotidien&nbsp;?</h2>
                       <p class="question-subtitle">S√©lectionnez toutes les r√©ponses qui s'appliquent</p>
                   </div>
                   <div class="options-container">
                       <div class="option-card" data-value="sorties">
                           <input type="checkbox" />
                           <span class="option-emoji">‚ùå</span>
                           <div class="option-text">
                               <div class="option-label">J'√©vite les sorties au restaurant ou entre amis</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="incomprise">
                           <input type="checkbox" />
                           <span class="option-emoji">üòî</span>
                           <div class="option-text">
                               <div class="option-label">Je me sens incomprise par mon entourage</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="travail">
                           <input type="checkbox" />
                           <span class="option-emoji">üíº</span>
                           <div class="option-text">
                               <div class="option-label">√áa impacte mon travail ou ma performance</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="fatigue">
                           <input type="checkbox" />
                           <span class="option-emoji">üò¥</span>
                           <div class="option-text">
                               <div class="option-label">Je suis constamment fatigu√©e</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="tete">
                           <input type="checkbox" />
                           <span class="option-emoji">üß†</span>
                           <div class="option-text">
                               <div class="option-label">J'ai l'impression que c'est "dans ma t√™te"</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="couple">
                           <input type="checkbox" />
                           <span class="option-emoji">üíî</span>
                           <div class="option-text">
                               <div class="option-label">Ma vie de couple en souffre</div>
                           </div>
                       </div>
                   </div>
               </div>
               <button class="continue-button" disabled>Continuer</button>
           </section>

           <!-- Question 6 -->
           <section class="question-section" id="q6">
               <div class="question-content">
                   <div class="question-header">
                       <h2 class="question-title">üîç Qu'avez-vous d√©j√† essay√© pour soulager vos sympt√¥mes&nbsp;?</h2>
                       <p class="question-subtitle">S√©lectionnez toutes les r√©ponses qui s'appliquent</p>
                   </div>
                   <div class="options-container">
                       <div class="option-card" data-value="medicaments">
                           <input type="checkbox" />
                           <span class="option-emoji">üíä</span>
                           <div class="option-text">
                               <div class="option-label">M√©dicaments</div>
                               <div class="option-description">Anti-spasmodiques, laxatifs‚Ä¶</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="regimes">
                           <input type="checkbox" />
                           <span class="option-emoji">ü•ó</span>
                           <div class="option-text">
                               <div class="option-label">R√©gimes restrictifs</div>
                               <div class="option-description">FODMAP, sans gluten, sans lactose‚Ä¶</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="probiotiques">
                           <input type="checkbox" />
                           <span class="option-emoji">ü¶†</span>
                           <div class="option-text">
                               <div class="option-label">Probiotiques du commerce</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="consultations">
                           <input type="checkbox" />
                           <span class="option-emoji">ü©∫</span>
                           <div class="option-text">
                               <div class="option-label">Consultations m√©dicales</div>
                               <div class="option-description">Sans solution durable</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="naturel">
                           <input type="checkbox" />
                           <span class="option-emoji">üåø</span>
                           <div class="option-text">
                               <div class="option-label">Rem√®des naturels</div>
                               <div class="option-description">Tisanes, huiles essentielles‚Ä¶</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="rien">
                           <input type="checkbox" />
                           <span class="option-emoji">üôÖ‚Äç‚ôÄÔ∏è</span>
                           <div class="option-text">
                               <div class="option-label">Rien de tout √ßa</div>
                               <div class="option-description">Je ne sais plus quoi essayer</div>
                           </div>
                       </div>
                   </div>
               </div>
               <button class="continue-button" disabled>Continuer</button>
           </section>

           <!-- Question 7 -->
           <section class="question-section" id="q7">
               <div class="question-content">
                   <div class="question-header">
                       <h2 class="question-title">üí≠ Quelle phrase vous correspond le plus en ce moment&nbsp;?</h2>
                       <p class="question-subtitle">Soyez honn√™te avec vous-m√™me</p>
                   </div>
                   <div class="options-container">
                       <div class="option-card" data-value="marre">
                           <span class="option-emoji">üò§</span>
                           <div class="option-text">
                               <div class="option-label">"J'en ai marre, je veux une solution MAINTENANT"</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="espoir">
                           <span class="option-emoji">üòû</span>
                           <div class="option-text">
                               <div class="option-label">"Je commence √† perdre espoir‚Ä¶"</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="sceptique">
                           <span class="option-emoji">ü§î</span>
                           <div class="option-text">
                               <div class="option-label">"Je suis sceptique mais pr√™te √† essayer encore"</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="determinee">
                           <span class="option-emoji">üí™</span>
                           <div class="option-text">
                               <div class="option-label">"Je suis d√©termin√©e √† r√©gler √ßa, quoi qu'il en co√ªte"</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="perdue">
                           <span class="option-emoji">üÜò</span>
                           <div class="option-text">
                               <div class="option-label">"Je me sens perdue, je ne sais plus quoi faire"</div>
                           </div>
                       </div>
                   </div>
               </div>
           </section>

           <!-- Question 8 -->
           <section class="question-section" id="q8">
               <div class="question-content">
                   <div class="question-header">
                       <h2 class="question-title">‚ú® Si vous pouviez r√©soudre vos probl√®mes digestifs, qu'est-ce qui changerait dans votre vie&nbsp;?</h2>
                       <p class="question-subtitle">Imaginez votre vie sans ces troubles</p>
                   </div>
                   <div class="options-container">
                       <div class="option-card" data-value="sorties-plaisir">
                           <span class="option-emoji">üéâ</span>
                           <div class="option-text">
                               <div class="option-label">Je pourrais enfin profiter des sorties sans stress</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="manger-plaisir">
                           <span class="option-emoji">üçΩÔ∏è</span>
                           <div class="option-text">
                               <div class="option-label">Je mangerais √† nouveau avec plaisir et sans peur</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="energie">
                           <span class="option-emoji">‚ö°</span>
                           <div class="option-text">
                               <div class="option-label">J'aurais plus d'√©nergie et de joie de vivre</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="bien-etre">
                           <span class="option-emoji">üßò‚Äç‚ôÄÔ∏è</span>
                           <div class="option-text">
                               <div class="option-label">Je me sentirais enfin bien dans mon corps</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="tout">
                           <span class="option-emoji">üåü</span>
                           <div class="option-text">
                               <div class="option-label">Toutes ces r√©ponses !</div>
                           </div>
                       </div>
                   </div>
               </div>
           </section>

           <!-- Question 9 -->
           <section class="question-section" id="q9">
               <div class="question-content">
                   <div class="question-header">
                       <h2 class="question-title">üò∞ √Ä quelle fr√©quence ressentez-vous du stress ou vous sentez-vous submerg√©e&nbsp;?</h2>
                       <p class="question-subtitle">S√©lectionnez la r√©ponse qui correspond le mieux</p>
                   </div>
                   <div class="options-container">
                       <div class="option-card" data-value="toujours">
                           <span class="option-emoji">ü•µ</span>
                           <div class="option-text">
                               <div class="option-label">Toujours</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="parfois">
                           <span class="option-emoji">üòü</span>
                           <div class="option-text">
                               <div class="option-label">Parfois</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="rarement">
                           <span class="option-emoji">üôÇ</span>
                           <div class="option-text">
                               <div class="option-label">Rarement</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="jamais">
                           <span class="option-emoji">üòå</span>
                           <div class="option-text">
                               <div class="option-label">Jamais</div>
                           </div>
                       </div>
                   </div>
               </div>
           </section>

           <!-- Question 10 -->
           <section class="question-section" id="q10">
               <div class="question-content">
                   <div class="question-header">
                       <h2 class="question-title">‚è±Ô∏è Dans combien de temps aimeriez-vous voir des r√©sultats&nbsp;?</h2>
                       <p class="question-subtitle">Chaque parcours est unique</p>
                   </div>
                   <div class="options-container">
                       <div class="option-card" data-value="urgent">
                           <span class="option-emoji">‚ö°</span>
                           <div class="option-text">
                               <div class="option-label">Le plus vite possible</div>
                               <div class="option-description">J'ai un √©v√©nement important</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="3-4-semaines">
                           <span class="option-emoji">üìÖ</span>
                           <div class="option-text">
                               <div class="option-label">Dans les 3-4 semaines</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="peu-importe">
                           <span class="option-emoji">üéØ</span>
                           <div class="option-text">
                               <div class="option-label">Peu importe, tant que √ßa marche</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="progressif">
                           <span class="option-emoji">üå±</span>
                           <div class="option-text">
                               <div class="option-label">Je pr√©f√®re une solution progressive mais durable</div>
                           </div>
                       </div>
                   </div>
               </div>
           </section>
           <!-- Question 11 -->
           <section class="question-section" id="q11">
               <div class="question-content">
                   <div class="question-header">
                       <h2 class="question-title">üïê Quand ressentez-vous habituellement un inconfort digestif&nbsp;?</h2>
                       <p class="question-subtitle">S√©lectionnez toutes les r√©ponses qui s'appliquent</p>
                   </div>
                   <div class="options-container">
                       <div class="option-card" data-value="apres-repas">
                           <input type="checkbox" />
                           <span class="option-emoji">üçΩÔ∏è</span>
                           <div class="option-text">
                               <div class="option-label">Juste apr√®s un repas</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="matin">
                           <input type="checkbox" />
                           <span class="option-emoji">üåÖ</span>
                           <div class="option-text">
                               <div class="option-label">D√®s le r√©veil le matin</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="apres-boisson">
                           <input type="checkbox" />
                           <span class="option-emoji">ü•§</span>
                           <div class="option-text">
                               <div class="option-label">Apr√®s avoir bu</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="coucher">
                           <input type="checkbox" />
                           <span class="option-emoji">üåô</span>
                           <div class="option-text">
                               <div class="option-label">Au moment du coucher</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="irregulier">
                           <input type="checkbox" />
                           <span class="option-emoji">üîÑ</span>
                           <div class="option-text">
                               <div class="option-label">De mani√®re irr√©guli√®re</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="aucun">
                           <input type="checkbox" />
                           <span class="option-emoji">üö´</span>
                           <div class="option-text">
                               <div class="option-label">Aucune de ces r√©ponses</div>
                           </div>
                       </div>
                   </div>
               </div>
               <button class="continue-button" disabled>Continuer</button>
           </section>

           <!-- Question 12 -->
           <section class="question-section" id="q12">
               <div class="question-content">
                   <div class="question-header">
                       <h2 class="question-title">üìä √Ä quelle fr√©quence ressentez-vous des troubles digestifs&nbsp;?</h2>
                       <p class="question-subtitle">Choisissez une seule r√©ponse</p>
                   </div>
                   <div class="options-container">
                       <div class="option-card" data-value="souvent">
                           <span class="option-emoji">ü•∫</span>
                           <div class="option-text">
                               <div class="option-label">Souvent</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="parfois">
                           <span class="option-emoji">üòï</span>
                           <div class="option-text">
                               <div class="option-label">Parfois</div>
                           </div>
                       </div>
                       <div class="option-card" data-value="rarement">
                           <span class="option-emoji">üôÇ</span>
                           <div class="option-text">
                               <div class="option-label">Rarement</div>
                           </div>
                       </div>
                   </div>
               </div>
           </section>
           <!-- Question Email -->
          <section class="question-section" id="emailQuestion">
              <div class="question-content">
                  <div class="question-header">
                      <h2 class="question-title">D√©couvrez votre profil digestif personnalis√©</h2>
                      <p class="question-subtitle">Entrez votre email pour recevoir vos r√©sultats d√©taill√©s et des conseils personnalis√©s</p>
                  </div>
                  <div class="options-scroll-container">
                      <!-- === SLOT EMAIL (√† mettre dans l‚Äô√©tape #emailQuestion) === -->
<div id="sioEmailSlot" class="options-container">
  <div id="sioEmailLoading" class="input-field" style="display:flex;align-items:center;justify-content:center;height:26.7px;">
    Chargement du champ email‚Ä¶
  </div>
</div>

<script>
/**
 * Instrumentation email SIO (debug) pour l‚Äô√©tape #emailQuestion :
 * - garde ¬´ Continuer ¬ª (quiz) visible
 * - le branche pour cliquer le bouton SIO natif (proxy)
 * - ajoute des logs [SIO][DBG] + window.sioDbg.dump()
 */
(function () {
  const log  = (...a) => console.log('%c[SIO][DBG]', 'color:#0ea5e9;font-weight:700', ...a);
  const warn = (...a) => console.warn('%c[SIO][WRN]', 'color:#f59e0b;font-weight:700', ...a);
  const err  = (...a) => console.error('%c[SIO][ERR]', 'color:#ef4444;font-weight:700', ...a);

  // Gate CSS : masquer l‚Äôinput email SIO partout sauf dans notre mount
  (function injectGateCss(){
    if (document.getElementById('sioEmailGate')) return;
    const css = document.createElement('style');
    css.id = 'sioEmailGate';
    css.textContent = `
      input[name="email"] { display:none !important; }
      #sioFieldsMount input[name="email"] { display:block !important; }
    `;
    (document.head || document.documentElement).appendChild(css);
  })();

  const EMAIL_SEL = [
    'input[type="email"]',
    'input[name="email"]',
    'input[name*="email" i]',
    'input[id*="email" i]',
    'input[placeholder*="mail" i]',
    'input[id^="field-"]'
  ].join(', ');

  // On cible des submit-button SIO "classiques" (on √©vite le bouton "Continuer" du quiz)
  const SUBMIT_SEL = [
    'button[type="submit"]',
    'input[type="submit"]',
    '[data-test-id="send-form-button"]',
    '[data-testid="send-form-button"]',
    '.sio-subscribe-button',
    '.sio-submit',
    '[data-element="cta-button"]',
    'button[id^="button-"]'
  ].join(', ');

  function instrumentEmailStage() {
    const slot = document.getElementById('sioEmailSlot');
    if (!slot) { warn('slot #sioEmailSlot introuvable'); return false; }

    // 1) Mount unique √† l‚Äôint√©rieur du slot
    let mount = slot.querySelector('#sioFieldsMount');
    if (!mount) {
      mount = document.createElement('div');
      mount.id = 'sioFieldsMount';
      mount.style.display = 'flex';
      mount.style.flexDirection = 'column';
      mount.style.gap = '12px';
      slot.innerHTML = '';
      slot.appendChild(mount);
      log('mount cr√©√©');
    }

    // 2) Email SIO
    const emailInputs = Array.from(document.querySelectorAll(EMAIL_SEL));
    const email = emailInputs.length ? emailInputs[emailInputs.length - 1] : null;
    log('email input trouv√© ?', !!email, email);

    // 3) Form + bouton SIO natif
    const form  = email && (email.closest('form') || email.form) || null;
    let nativeBtn = form ? form.querySelector(SUBMIT_SEL) : null;
    if (!nativeBtn) {
      // fallback large si SIO n‚Äôutilise pas <form>
      nativeBtn = (email && (email.closest('#emailQuestion') || document)).querySelector(SUBMIT_SEL) || null;
    }
    log('form trouv√© ?', !!form);
    log('bouton SIO natif ?', !!nativeBtn, nativeBtn);
    if (nativeBtn) {
      const cs = getComputedStyle(nativeBtn);
      log('style bouton SIO :', {
        disabled: nativeBtn.disabled,
        display: cs.display,
        visibility: cs.visibility
      });
    }

    // 4) D√©placer l‚Äôinput dans le mount
    if (email && !mount.contains(email)) {
      const loading = document.getElementById('sioEmailLoading');
      if (loading) loading.remove();

      const wrap = document.createElement('div');
      wrap.className = 'input-field';
      wrap.style.padding = '6.7px 14px';
      wrap.style.border = '2px solid #e5e7eb';
      wrap.style.borderRadius = '10px';

      email.style.width = '100%';
      email.style.border = '0';
      email.style.outline = 'none';
      email.style.fontSize = '0.95rem';
      if (!email.placeholder) email.placeholder = 'Votre email';

      wrap.appendChild(email);
      mount.appendChild(wrap);
      log('champ email d√©plac√© dans le mount');
    }

    // 5) Ins√©rer le mount DANS le <form> si possible (et avant le bouton SIO)
    if (form && mount.parentElement !== form) {
      const anchor = form.querySelector(SUBMIT_SEL) || form.firstChild;
      form.insertBefore(mount, anchor || null);
      log('mount ins√©r√© dans <form>');
    }

    // 6) D√©placer/styliser le bouton SIO sous l‚Äôemail
    if (nativeBtn && !mount.contains(nativeBtn)) {
      const row = document.createElement('div');
      row.style.display = 'flex';
      row.style.flexDirection = 'column';
      row.style.gap = '8px';

      if (!nativeBtn.dataset._sioStyled) {
        nativeBtn.style.width = '100%';
        nativeBtn.style.height = '48px';
        nativeBtn.style.borderRadius = '12px';
        nativeBtn.dataset._sioStyled = '1';
      }

      row.appendChild(nativeBtn);
      mount.appendChild(row);
      log('bouton SIO d√©plac√© sous le champ email');
    }

    // 7) Brancher le ¬´ Continuer ¬ª du quiz pour CLIQUER le bouton SIO
    const quizContinue = document.querySelector('#emailQuestion .continue-button');
    if (quizContinue && !quizContinue.dataset.sioBound) {
      quizContinue.dataset.sioBound = '1';
      // on s‚Äôassure qu‚Äôil est visible/actif
      quizContinue.style.display = '';
      quizContinue.disabled = false;
      quizContinue.classList.remove('disabled');

      quizContinue.addEventListener('click', (e) => {
        log('CLICK sur "Continuer" (quiz) ‚Üí proxy sur bouton SIO');
        e.preventDefault();
        e.stopPropagation(); // emp√™che toute navigation parasite

        const btn = (form && form.querySelector(SUBMIT_SEL)) || nativeBtn || document.querySelector(SUBMIT_SEL);
        if (btn && typeof btn.click === 'function') {
          btn.click();                     // d√©clenche les validations SIO
          log('‚Üí nativeBtn.click() ex√©cut√©');
        } else if (form) {
          if (form.requestSubmit) form.requestSubmit(); else form.submit();
          log('‚Üí form.submit() ex√©cut√© (fallback)');
        } else {
          err('Aucun bouton SIO detect√© ‚Äî rien envoy√©.');
        }
      }, true);

      log('Listener debug ajout√© sur le bouton "Continuer" (quiz)');
      log('Tips: appelle window.sioDbg.dump() dans la console pour voir l‚Äô√©tat courant');
    }

    // 8) Miroir d‚Äô√©tat disabled/visibility du bouton SIO ‚Üí sur le bouton quiz
    if (nativeBtn && quizContinue) {
      const apply = () => {
        const cs = getComputedStyle(nativeBtn);
        const shouldDisable = !!nativeBtn.disabled || cs.display === 'none' || cs.visibility === 'hidden';
        quizContinue.disabled = shouldDisable;
        quizContinue.classList.toggle('disabled', shouldDisable);
      };
      apply();
      const mo = new MutationObserver(apply);
      mo.observe(nativeBtn, { attributes: true, attributeFilter: ['disabled', 'style', 'class'] });
      window.__sioBtnMirror = mo;
    }

    // 9) Helper debug
    window.sioDbg = {
      dump() {
        const state = {
          emailFound: !!email,
          formFound: !!form,
          nativeBtnFound: !!nativeBtn,
          continueFound: !!document.querySelector('#emailQuestion .continue-button'),
          emailInput: email,
          nativeBtn,
          form,
          mount
        };
        console.log('%c[SIO][DBG] dump ‚Üí', 'color:#0ea5e9;font-weight:700');
        console.log(state);
        return state;
      }
    };

    return !!email;
  }

  function onEmailStageOpen() {
    log('showEmailQuestion WRAPPED (debug)');
    let n = 0;
    const tick = setInterval(() => {
      n++;
      log('post-open: on tente d‚Äôidentifier les √©l√©ments SIO (form, bouton, input)');
      const ok = instrumentEmailStage();
      if (ok || n >= 12) clearInterval(tick);
    }, 250);
  }

  // Armer le wrapper ou l‚Äôobserver de visibilit√©
  if (typeof window.showEmailQuestion === 'function' && !window.showEmailQuestion.__sioWrapped) {
    const orig = window.showEmailQuestion;
    window.showEmailQuestion = function wrappedShowEmailQuestion() {
      const r = orig.apply(this, arguments);
      onEmailStageOpen();
      return r;
    };
    window.showEmailQuestion.__sioWrapped = true;
    log('showEmailQuestion() appel√© ‚Üí on ouvre l‚Äô√©tape email');
  } else {
    const target = document.getElementById('emailQuestion');
    const visible = () => target && getComputedStyle(target).display !== 'none';
    if (visible()) {
      onEmailStageOpen();
    } else {
      const mo = new MutationObserver(() => {
        if (visible()) {
          mo.disconnect();
          onEmailStageOpen();
        }
      });
      mo.observe(document.documentElement, { childList: true, subtree: true, attributes: true });
      log('observer arm√© (fallback visibilit√©)');
    }
  }
})();
</script>
                  </div>
                  <div class="email-step-actions">
                      <button class="continue-button" type="button">Continuer</button>
                  </div>
              </div>
          </section>
      </main>
   </div>

   <script>
       // √âtat de l'application
       let currentStep = 1;
       const totalSteps = 12;
       const answers = {};

       // √âl√©ments DOM
       const backButton = document.getElementById('backButton');
       const stepCounter = document.getElementById('stepCounter');
       const progressFill = document.getElementById('progressFill');
       const emailSection = document.getElementById('emailQuestion');
       const sioEmailSlot = document.getElementById('sioEmailSlot');

       // Gestion du bouton retour
       backButton.addEventListener('click', () => {
           if (currentStep > 1) {
               goToStep(currentStep - 1);
           }
       });

       // Mise √† jour de l'interface
       function updateUI() {
           stepCounter.textContent = `${currentStep}/${totalSteps}`;
           const progress = (currentStep / totalSteps) * 100;
           progressFill.style.width = `${progress}%`;
           backButton.style.visibility = currentStep > 1 ? 'visible' : 'hidden';
       }

       // Navigation entre les questions
       function goToStep(step) {
           document.querySelectorAll('.question-section').forEach(section => {
               section.classList.remove('active');
           });
           
           const targetSection = document.getElementById(`q${step}`) || document.getElementById('emailQuestion');
           if (targetSection) {
               targetSection.classList.add('active');
               currentStep = step;
               updateUI();
           }
       }

       // Gestion des options √† choix unique
       document.querySelectorAll('.question-section').forEach((section, index) => {
           if (section.id === 'emailQuestion') {
               return;
           }

           const questionId = `q${index + 1}`;
           const options = section.querySelectorAll('.option-card');
           const continueBtn = section.querySelector('.continue-button');
           const hasCheckboxes = section.querySelector('input[type="checkbox"]') !== null;

           if (!hasCheckboxes) {
               options.forEach(option => {
                   option.addEventListener('click', () => {
                       options.forEach(opt => opt.classList.remove('selected'));
                       option.classList.add('selected');
                       answers[questionId] = option.dataset.value;
                       if (continueBtn) continueBtn.disabled = false;

                       if (!continueBtn && options.length > 0) {
                           if (index + 1 < totalSteps) {
                               goToStep(index + 2);
                           } else {
                               showEmailQuestion();
                           }
                       }
                   });
               });
           } else {
               // Gestion des cases √† cocher
               options.forEach(option => {
                   const checkbox = option.querySelector('input[type="checkbox"]');
                   if (checkbox) {
                       option.addEventListener('click', (e) => {
                           if (e.target !== checkbox) {
                               checkbox.checked = !checkbox.checked;
                           }
                           option.classList.toggle('selected', checkbox.checked);
                           
                           const checkedValues = Array.from(section.querySelectorAll('input[type="checkbox"]:checked'))
                               .map(cb => cb.parentElement.dataset.value);
                           
                           answers[questionId] = checkedValues;
                           if (continueBtn) continueBtn.disabled = checkedValues.length === 0;
                       });
                   }
               });
           }

           if (continueBtn) {
               continueBtn.addEventListener('click', () => {
                   if (index + 1 < totalSteps) {
                       goToStep(index + 2);
                   } else {
                       showEmailQuestion();
                   }
               });
           }
       });

       // Afficher la question email
       function showEmailQuestion() {
           document.querySelectorAll('.question-section').forEach(section => {
               section.classList.remove('active');
           });
           if (emailSection) {
               emailSection.classList.add('active');
           }
           currentStep = totalSteps;
           updateUI();
           const appContent = document.querySelector('.app-content');
           if (appContent) {
               appContent.scrollTop = 0;
           }
       }

       if (sioEmailSlot) {
           const removeLoadingPlaceholder = () => {
               const loading = document.getElementById('sioEmailLoading');
               if (loading && sioEmailSlot.querySelector('form')) {
                   loading.remove();
               }
           };

           const observer = new MutationObserver(() => {
               removeLoadingPlaceholder();
           });

           observer.observe(sioEmailSlot, { childList: true, subtree: true });
           removeLoadingPlaceholder();
       }

       // Initialisation
       updateUI();
   </script>
   <script>
   (function () {
     function clickSio() {
       const email = document.querySelector('#emailQuestion input[name="email"]');
       const form  = email && (email.closest('form') || email.form);
       const btn   = form && form.querySelector(
         'button[type="submit"],input[type="submit"],.sio-subscribe-button,.sio-submit,[data-element="cta-button"],[data-test-id="send-form-button"],[data-testid="send-form-button"],button[id^="button-"]'
       );
       if (btn && typeof btn.click === 'function') { btn.click(); return true; }
       if (form) { if (form.requestSubmit) form.requestSubmit(); else form.submit(); return true; }
       return false;
     }

     const original = document.querySelector('#emailQuestion .continue-button');
     if (!original) return;

     // On supprime tous les anciens listeners et on emp√™che toute propagation
     const btn = original.cloneNode(true);
     original.parentNode.replaceChild(btn, original);
     btn.addEventListener('click', function (e) {
       e.preventDefault();
       e.stopPropagation();
       e.stopImmediatePropagation();
       clickSio();
       return false;
     }, { capture: true });

     // Enter => submit SIO uniquement
     const emailStep = document.getElementById('emailQuestion');
     if (emailStep) {
       emailStep.addEventListener('keydown', (e) => {
         if (e.key === 'Enter') {
           e.preventDefault(); e.stopPropagation(); e.stopImmediatePropagation();
           clickSio();
         }
       }, { capture: true });
     }
   })();
  </script>
  <script>
/* ===== DEBUG SIO ‚Äî instrumentation console pour l'√©tape email ===== */
(function () {
  const style = "color:#059669;font-weight:700";
  const log   = (...a)=>console.log("%c[SIO][DBG]", style, ...a);
  const warn  = (...a)=>console.warn("%c[SIO][WARN]", style, ...a);
  const error = (...a)=>console.error("%c[SIO][ERR]", style, ...a);

  const q  = (s, r=document)=>r.querySelector(s);
  const qa = (s, r=document)=>Array.from(r.querySelectorAll(s));

  // Expose un mini tableau de bord pour debug manuel
  window.sioDbg = {
    step: null,
    emailInput: null,
    form: null,
    nativeBtn: null,
    lastClickTs: null,
    dump(){
      log("dump", {
        step: this.step,
        emailInput: !!this.emailInput,
        form: !!this.form,
        nativeBtn: !!this.nativeBtn,
        lastClickTs: this.lastClickTs
      });
      if (this.nativeBtn) {
        const cs = getComputedStyle(this.nativeBtn);
        log("nativeBtn visible?", cs.display !== "none", "disabled?", this.nativeBtn.disabled);
      }
    }
  };

  // Helpers pour afficher un chemin court dans les logs
  function shortSel(el){
    if (!el) return "‚àÖ";
    const id = el.id ? "#"+el.id : "";
    const cls = (el.className && typeof el.className === "string") ? "."+el.className.trim().split(/\s+/).slice(0,2).join(".") : "";
    return `<${el.tagName.toLowerCase()}${id}${cls}>`;
  }

  // 1) Instrumenter l‚Äôouverture de l‚Äô√©tape email
  if (typeof window.showEmailQuestion === "function" && !window.showEmailQuestion.__dbgWrapped) {
    const orig = window.showEmailQuestion;
    window.showEmailQuestion = function(){
      log("showEmailQuestion() appel√© ‚Üí on ouvre l'√©tape email");
      const r = orig.apply(this, arguments);
      setTimeout(() => {
        log("post-open: on tente d‚Äôidentifier les √©l√©ments SIO (form, bouton, input)");
        instrumentEmailStage();
      }, 0);
      return r;
    };
    window.showEmailQuestion.__dbgWrapped = true;
    log("showEmailQuestion WRAPPED (debug)");
  } else {
    // Fallback: observer l‚Äôapparition de #emailQuestion
    const mo = new MutationObserver(() => {
      const el = q("#emailQuestion");
      if (el && getComputedStyle(el).display !== "none") {
        mo.disconnect();
        log("Observer: #emailQuestion visible ‚Üí instrumentation");
        setTimeout(instrumentEmailStage, 0);
      }
    });
    mo.observe(document.documentElement, { childList:true, subtree:true, attributes:true });
    log("Observer arm√© (en attente d‚Äô#emailQuestion)");
  }

  // 2) Instrumenter les √©l√©ments cl√©s de l‚Äô√©tape email
  function instrumentEmailStage(){
    const slot = q("#sioEmailSlot");
    const emailQuestion = q("#emailQuestion");
    if (!emailQuestion) { warn("#emailQuestion introuvable"); return; }
    log("instrumentEmailStage: emailQuestion display =", getComputedStyle(emailQuestion).display);

    const EMAIL_SEL = [
      'input[name="email"]',
      'input[type="email"]',
      'input[name*="email" i]',
      'input[id*="email" i]',
      'input[placeholder*="mail" i]',
      'input[id^="field-"]'
    ].join(", ");

    // Rechercher l‚Äôinput email et son form
    const inputs = qa(EMAIL_SEL, document);
    const emailInput = inputs.length ? inputs[inputs.length-1] : null;
    window.sioDbg.emailInput = emailInput;
    log("email input trouv√© ?", !!emailInput, emailInput ? shortSel(emailInput) : "");

    const form = emailInput && (emailInput.closest("form") || emailInput.form);
    window.sioDbg.form = form;
    log("form trouv√© ?", !!form, form ? shortSel(form) : "");

    // Essayer d‚Äôattraper le vrai bouton submit natif de Systeme.io
    const SUBMIT_SEL = [
      'button[type="submit"]','input[type="submit"]',
      '[data-test-id="send-form-button"]','[data-testid="send-form-button"]',
      '.sio-subscribe-button','.sio-submit','[data-element="cta-button"]',
      'button[id^="button-"]'
    ].join(", ");

    let nativeBtn = form ? q(SUBMIT_SEL, form) : null;
    if (!nativeBtn) nativeBtn = q(SUBMIT_SEL, document);
    window.sioDbg.nativeBtn = nativeBtn;
    log("bouton SIO natif ?", !!nativeBtn, nativeBtn ? shortSel(nativeBtn) : "");

    if (nativeBtn && !nativeBtn.__dbgBound) {
      nativeBtn.__dbgBound = true;
      nativeBtn.addEventListener("click", (ev)=>{
        log("‚Üí CLICK sur bouton SIO natif", "(isTrusted:", ev.isTrusted, ")", shortSel(ev.currentTarget));
      });
      const cs = getComputedStyle(nativeBtn);
      log("style bouton SIO:", { display: cs.display, visibility: cs.visibility, disabled: !!nativeBtn.disabled });
    }

    // 3) Instrumenter le bouton ‚ÄúContinuer‚Äù de l‚Äô√©tape email (celui du quiz)
    const continueBtn = q('#emailQuestion .continue-button');
    const backBtn = q('#emailStepBack');
    if (!continueBtn) { warn("continue-button (quiz) introuvable dans #emailQuestion"); }
    if (backBtn && !backBtn.__dbgBound) {
      backBtn.__dbgBound = true;
      backBtn.addEventListener("click", () => log('Clique sur "Retour" (√©tape email)'));
    }

    // Afficher l‚Äô√©tat de la sous-√©tape (identity vs email) √† chaque refresh
    const oldUpdate = window.updateEmailStepDisplay;
    if (typeof oldUpdate === "function" && !oldUpdate.__dbgWrapped) {
      window.updateEmailStepDisplay = function(){
        const out = oldUpdate.apply(this, arguments);
        const btn = q('#emailQuestion .continue-button');
        const identityVisible = !!q('#sioIdentitySection') && q('#sioIdentitySection').classList.contains('active');
        const emailVisible    = !!q('#sioEmailSection') && q('#sioEmailSection').classList.contains('active');
        window.sioDbg.step = btn ? btn.dataset.step : null;
        log("updateEmailStepDisplay ‚Üí step:", window.sioDbg.step, "| identity:", identityVisible, "| email:", emailVisible);
        return out;
      };
      window.updateEmailStepDisplay.__dbgWrapped = true;
      log("updateEmailStepDisplay WRAPPED (debug)");
    }

    // 4) Re-binder le click ‚ÄúContinuer‚Äù pour tracer ce qui se passe
    if (continueBtn && !continueBtn.__dbgBound) {
      continueBtn.__dbgBound = true;
      continueBtn.addEventListener("click", (e) => {
        window.sioDbg.lastClickTs = Date.now();
        const step = continueBtn.dataset.step;
        log('Clique sur "Continuer" (quiz) ‚Äî step =', step);

        // √âtape identit√© ‚Üí juste switcher en ‚Äúemail‚Äù
        if (step !== "email") {
          const fn = q('#sioIdentityMount input[name="first_name"]');
          const ln = q('#sioIdentityMount input[name="surname"]');
          const ok = !!(fn && fn.value.trim() && ln && ln.value.trim());
          log("Validation identit√©:", { haveFirstName: !!(fn && fn.value.trim()), haveLastName: !!(ln && ln.value.trim()) });
          if (!ok) {
            warn("Identit√© incompl√®te ‚Üí le script existant affiche un alert et focus l‚Äôinput manquant");
          } else {
            log("OK identit√© ‚Üí on doit passer √† l‚Äô√©tape 'email'");
          }
          return; // le handler original g√®re la suite
        }

        // √âtape email ‚Üí on doit cliquer le vrai bouton SIO
        const email = window.sioDbg.emailInput || q('input[name="email"]');
        const f = (window.sioDbg.form) || (email && (email.closest('form') || email.form));
        let btn = window.sioDbg.nativeBtn;
        if (!btn && f) btn = q(SUBMIT_SEL, f);
        if (!btn) btn = q(SUBMIT_SEL, document);

        log("Soumission:", {
          haveEmail: !!email, haveForm: !!f, haveNativeBtn: !!btn,
          btnSel: btn ? shortSel(btn) : '‚àÖ'
        });

        if (btn && typeof btn.click === "function") {
          log("‚Üí CLICK programmatique sur le bouton SIO natif");
          try { btn.click(); } catch (e) { error("√©chec click()", e); }
        } else if (f) {
          log("‚Üí Pas de bouton trouv√©, fallback sur form.requestSubmit()/submit()");
          try { f.requestSubmit ? f.requestSubmit() : f.submit(); } catch (e) { error("√©chec submit()", e); }
        } else {
          error("Aucun form ni bouton SIO d√©tect√© ‚Äî rien √† soumettre");
        }
      }, true); // useCapture pour tracer avant la logique existante
      log('Listener debug ajout√© sur le bouton "Continuer" (quiz)');
    }

    // 5) Observer les re-renders (SIO r√©inserte parfois son bouton)
    if (form && !form.__dbgMo) {
      const mo = new MutationObserver((ml)=>{
        const btnAgain = q('button[type="submit"], input[type="submit"], .sio-subscribe-button, .sio-submit, [data-element="cta-button"]', form);
        if (btnAgain && btnAgain !== window.sioDbg.nativeBtn) {
          window.sioDbg.nativeBtn = btnAgain;
          log("Mutation: nouveau bouton SIO rep√©r√© dans le <form> ‚Üí mis en cache", shortSel(btnAgain));
          if (!btnAgain.__dbgBound) {
            btnAgain.__dbgBound = true;
            btnAgain.addEventListener("click", (ev)=>{
              log("‚Üí CLICK sur bouton SIO natif (nouveau)", "(isTrusted:", ev.isTrusted, ")");
            });
          }
        }
      });
      mo.observe(form, { childList:true, subtree:true });
      form.__dbgMo = mo;
      log("MutationObserver pos√© sur le <form> SIO");
    }

    // Petits rappels
    log("Tips: appelle window.sioDbg.dump() dans la console pour voir l‚Äô√©tat courant");
  }
})();
  </script>
<script>
/* === PATCH: afficher le loader AVANT l‚Äô√©tape e-mail, jamais au d√©but === */
(function () {
  const loader       = document.getElementById('sioEmailLoading');
  const emailSection = document.getElementById('emailQuestion');
  if (!loader || !emailSection) return;

  const origShow   = window.showEmailQuestion;                 // version actuelle (d√©j√† "wrapp√©e" par tes scripts)
  const _toggleOri = window.toggleEmailLoading || function(){}; // garde l‚ÄôAPI d‚Äôorigine

  let firstTime = true;           // on ne veut le loader qu‚Äôune fois, juste avant l‚Äôemail
  let forceHideOnNextToggle = false;

  // Intercepte toggleEmailLoading pour forcer le masquage au prochain appel (emp√™che le "double affichage")
  window.toggleEmailLoading = function (visible) {
    if (forceHideOnNextToggle) {
      forceHideOnNextToggle = false;
      return _toggleOri(false);   // on masque co√ªte que co√ªte
    }
    return _toggleOri(visible);
  };

  // Monkey-patch de showEmailQuestion
  window.showEmailQuestion = function () {
    // 1er passage ‚Üí on montre d‚Äôabord le loader, puis on ouvre l‚Äô√©tape e-mail
    if (firstTime) {
      firstTime = false;

      // Masquer toutes les sections de questions
      document.querySelectorAll('.question-section').forEach(s => s.classList.remove('active'));

      // Afficher UNIQUEMENT le loader
      loader.hidden = false;

      // Optionnel: montrer "12/12" et 100% pendant le chargement
      try {
        if (typeof updateUI === 'function' && typeof totalSteps !== 'undefined') {
          const prev = typeof currentStep !== 'undefined' ? currentStep : null;
          currentStep = totalSteps;
          updateUI();
          if (prev !== null) currentStep = prev;
        } else {
          const sc = document.getElementById('stepCounter');
          const pf = document.getElementById('progressFill');
          if (sc && typeof totalSteps !== 'undefined') sc.textContent = `${totalSteps}/${totalSteps}`;
          if (pf) pf.style.width = '100%';
        }
      } catch(_) {}

      const appContent = document.querySelector('.app-content');
      if (appContent) appContent.scrollTop = 0;

      // Dur√©e du faux traitement (modifiable via data-timeout sur #sioEmailLoading)
      const attr = loader.getAttribute('data-timeout');
      let ms = attr ? parseInt(attr, 10) : 2200; // 2.2s par d√©faut
      if (!(ms > 0)) {
        // Petit heuristique: ~25% de --loading-duration si d√©finie (ex: "8s" -> 2000ms)
        const raw = getComputedStyle(document.documentElement).getPropertyValue('--loading-duration').trim();
        const n = parseFloat(raw);
        ms = n ? Math.max(1200, Math.round(n * 250)) : 2200;
      }

      // Apr√®s le d√©lai: on masque le loader et on ouvre l‚Äô√©tape e-mail SANS le r√©-afficher
      setTimeout(() => {
        forceHideOnNextToggle = true;  // neutralise l‚Äôappel interne √† toggleEmailLoading(true)
        loader.hidden = true;
        if (typeof origShow === 'function') {
          // Appelle la logique existante (wrappers et instrumentation inclus)
          return origShow.call(window);
        }
        // Fallback si origShow manquant
        emailSection.classList.add('active');
        if (typeof updateUI === 'function' && typeof totalSteps !== 'undefined') {
          currentStep = totalSteps;
          updateUI();
        }
      }, ms);

      return; // On s‚Äôarr√™te ici au 1er passage
    }

    // Passages suivants ‚Üí on s‚Äôassure juste que le loader reste cach√©
    forceHideOnNextToggle = true;
    loader.hidden = true;
    if (typeof origShow === 'function') return origShow.apply(this, arguments);
  };
})();
</script>
</body>
</html>
